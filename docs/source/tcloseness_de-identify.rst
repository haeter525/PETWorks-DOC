+++++++++++++++++++++++++++++++++++++++
t-相似性去識別化 API
+++++++++++++++++++++++++++++++++++++++

以下程式碼旨在對資料進行去識別化以滿足 t-相似性（t-closeness）。更多 t-相似性之說明，詳見 `此處 <#id4>`_ 。

我們以 ``data/adult.csv`` 作爲原始資料，``data/adult_hierarchy`` 目錄作爲資料階層定義，以及 ``attributeTypes`` 作為屬性型態定義，展示如何透過 PETWorks-framework 框架進行去識別化。

在以下程式碼中，我們透過 API ``PETAnonymization(originalData, tech, dataHierarchy, attributeTypes, maxSuppressionRate, t)``，以上述資料、“t-closeness” 字串、屬性型態定義、最大抑制處理比率 ``maxSuppressionRate`` 、以及目標 t 值作爲參數，進行去識別化。

再來，我們透過 API ``report(result, path)``，以上述結果與輸出檔案位置 ``path`` 作爲參數，輸出去識別化結果。

範例程式碼: t-closeness.py
---------------------------

.. code-block:: python

  from PETWorks import PETAnonymization, output
  from PETWorks.attributetypes import *
  
  originalData = "data/adult.csv"
  dataHierarchy = "data/adult_hierarchy"
  
  attributeTypes = {
      "sex": QUASI_IDENTIFIER,
      "age": QUASI_IDENTIFIER,
      "workclass": SENSITIVE_ATTRIBUTE,
  }
  
  result = PETAnonymization(
      originalData,
      "t-closeness",
      dataHierarchy,
      attributeTypes,
      maxSuppressionRate=0.6,
      t=0.2,
  )
  
  output(result, "output.csv")





輸出結果
---------------------------

上述程式碼將輸出滿足 t = 0.2 之 t-相似性去識別化結果至 `output.csv`。檔案內容節錄如下：

+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| sex    | age | race | marital-status | education | native-country | workclass        | occupation | salary-class |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 39  | \*   | \*             | \*        | \*             | State-gov        | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 50  | \*   | \*             | \*        | \*             | Self-emp-not-inc | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 38  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 53  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 28  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 37  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 49  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 52  | \*   | \*             | \*        | \*             | Self-emp-not-inc | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 31  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 42  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 37  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Male   | 30  | \*   | \*             | \*        | \*             | State-gov        | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| Female | 23  | \*   | \*             | \*        | \*             | Private          | \*         | \*           |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+
| ...    | ... | ...  | ...            | ...       | ...            | ...              | ...        | ...          |
+--------+-----+------+----------------+-----------+----------------+------------------+------------+--------------+

以本專案開發之 `t-相似性再識別化工具 <https://petworks-doc.readthedocs.io/en/latest/tcloseness.html>`_ 進行檢測，可確認去識別化結果已滿足 t = 0.2 之 t-相似性。

.. code-block:: json

  {
      "t": 0.2,
      "fulfill t-closeness": true
  }



t-相似性之定義
---------------------------

t-相似性（t-closeness）是一種隱私保護力指標，表示資料集中子群體的敏感資訊機率分佈與資料表整體的敏感資訊機率分佈之差異，是否不超過 t，該差異稱為推土機距離（Earth Mover’s distance）。一旦攻擊者發現子群體的敏感資訊機率分佈與整體資料表差異過大，可藉由資料表推敲出子群體的敏感資訊特徵。

推土機距離數值分佈在 0 到 1 之間。當數值越高，子群體的敏感資訊機率分佈與整體的敏感資訊機率分佈越迥異，攻擊者可分析出的特徵越多；當數值越低，子群體的敏感資訊機率分佈與整體的敏感資訊機率分佈越相似，攻擊者可分析出的特徵越少。

因此，指標使用可調配參數 t 限制推土機距離最大值。當參數 t 越小，子群體的敏感資訊機率分佈與整體的敏感資訊分佈被限制的越相似，攻擊者可分析出的特徵越少，敏感資訊得到的保障越大。

去識別化之計算
---------------------------

本專案之 t-相似性去識別化 API，為串接開源工具 ARX 之去識別化演算法進行。該演算法的處理流程可簡述如下：

1. 參考個體背景資訊定義與屬性型態定義，列舉並排序所有可能的去識別化處理強度組合。
2. 利用二分搜尋法，找出滿足 t 值設定，且去識別化處理強度最弱的組合。
3. 依據步驟 2. 的組合進行去識別化，輸出去識別化結果。

詳細處理流程請參閱 ARX 官方提供之 `去識別化演算法說明文件 <https://arx.deidentifier.org/development/algorithms/>`_ 。



